

model Provider {
    id        String    @id @default(uuid())
    name      String    @unique
    baseUrl   String
    apiKey    String // Encrypted with AWS KMS
    models    AIModel[]
    createdAt DateTime  @default(now())
    updatedAt DateTime  @updatedAt
}

model AIModel {
    id          String      @id @default(uuid())
    externalId  String // Original provider ID (e.g., "llama3.1-8b")
    provider    Provider    @relation(fields: [providerId], references: [id])
    providerId  String
    name        String?
    owner       String?
    parameters  BigInt? // 70000000000 for 70B model
    inputCost   Float // USD per 1M tokens
    outputCost  Float // USD per 1M tokens
    created     DateTime // From provider's timestamp
    lastFetched DateTime    @updatedAt
    errorCount  Int         @default(0)
    status      ModelStatus @default(OPERATIONAL)
    siblings    AIModel[]   @relation("ModelSiblings")
    siblingOf   AIModel[]   @relation("ModelSiblings")

    @@unique([providerId, externalId])
}

model APIKey {
    id         String     @id @default(uuid())
    key        String     @unique // Hashed value of undrstnd_{random32}
    name       String?
    tier       ApiKeyTier @default(FREE)
    userId     String? // Optional link to a user
    createdAt  DateTime   @default(now())
    updatedAt  DateTime   @updatedAt
    lastUsedAt DateTime?
    rateLimit  Int // Requests per hour
    isRevoked  Boolean    @default(false)
}

model RequestLog {
    id           String   @id @default(uuid())
    apiKeyId     String?
    modelId      String?
    endpoint     String
    statusCode   Int
    duration     Int // In milliseconds
    inputTokens  Int?
    outputTokens Int?
    timestamp    DateTime @default(now())
}
